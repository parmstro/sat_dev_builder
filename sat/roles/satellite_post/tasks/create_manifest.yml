---
# Create the Satellite manifest, first add creates a manifest if it doesn't exist.
#
- name: Include manifest variables
  ansible.builtin.include_vars: 
    dir: "{{ playbook_dir }}/vars/manifest"

- name: Clean up any existing manifest
  ansible.builtin.include_tasks: "{{ role_path }}/tasks/clean_manifest.yml"

- name: Create the manifest and attach subs
  ansible.builtin.include_tasks: "{{ role_path }}/tasks/add_sub_2_manifest.yml"
  loop: "{{ manifest_subs }}"
  loop_control:
    loop_var: sub
  when: manifest_subs is defined

- name: Ensure we fetch the new manifest
  ansible.builtin.set_fact:
    manifest_fetch_manifest: true
